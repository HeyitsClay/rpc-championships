<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPC Championships</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        html, body {
            height: 100%;
            width: 100%;
            background: #000;
            color: #fff;
            font-family: sans-serif;
            overflow: hidden;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .screen.active { display: flex; }

        h1 { font-size: 24px; margin: 20px 0; text-align: center; }
        h2 { font-size: 20px; margin: 15px 0; text-align: center; }
        
        .btn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            margin: 10px 0;
            cursor: pointer;
        }

        .scoreboard {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border: 1px solid #333;
            margin: 10px 0;
        }

        .moves-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            margin: 20px 0;
        }

        .move-btn {
            aspect-ratio: 1;
            font-size: 40px;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            cursor: pointer;
        }

        .move-btn.selected { border-color: #fff; background: #444; }

        .progress-row {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }

        .progress-dot {
            width: 30px;
            height: 30px;
            border: 1px solid #555;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .progress-dot.filled { background: #333; }
        .progress-dot.current { border-color: #fff; background: #222; }

        .countdown-text {
            font-size: 32px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .fighters {
            display: flex;
            justify-content: space-between;
            font-size: 60px;
            margin: 20px 0;
            padding: 0 40px;
        }

        .result-text {
            font-size: 24px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }

        .round-pips {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 10px 0;
        }

        .pip {
            width: 15px;
            height: 15px;
            border: 1px solid #555;
            border-radius: 50%;
        }

        .pip.p1 { background: #fff; }
        .pip.p2 { background: #666; }
        .pip.tie { background: #333; }

        .color-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 0;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #555;
            cursor: pointer;
        }

        .color-btn.selected { border-color: #fff; }
        .color-btn.disabled { opacity: 0.3; }
    </style>
</head>
<body>
    <!-- SETUP -->
    <div id="setup" class="screen active">
        <h1>RPC Championships</h1>
        <p style="text-align:center; margin:10px 0;">Victory: First to <span id="sets-target">2</span> sets</p>
        <div style="display:flex; gap:10px; justify-content:center; margin:10px 0;">
            <button class="btn" style="width:auto; padding:10px 20px;" onclick="game.adjustSets(-1)">-</button>
            <button class="btn" style="width:auto; padding:10px 20px;" onclick="game.adjustSets(1)">+</button>
        </div>
        
        <h2>Player 1</h2>
        <div class="color-grid" id="p1-colors"></div>
        
        <h2>Player 2</h2>
        <div class="color-grid" id="p2-colors"></div>
        
        <button class="btn" onclick="game.startGame()" style="margin-top:auto;">Start Game</button>
    </div>

    <!-- P1 READY -->
    <div id="p1-ready" class="screen">
        <div class="scoreboard">
            <div><div id="p1-ready-name">P1</div><div id="p1-ready-score">0</div></div>
            <div>VS</div>
            <div><div id="p2-ready-name">P2</div><div id="p2-ready-score">0</div></div>
        </div>
        <h2 id="p1-ready-title">Player 1: Select 7 Moves</h2>
        <button class="btn" onclick="game.toSelection(1)">Pick Moves</button>
    </div>

    <!-- P1 SELECT -->
    <div id="p1-select" class="screen">
        <h2>Round <span id="p1-round-num">1</span>/7</h2>
        <div class="progress-row" id="p1-progress"></div>
        <div class="moves-grid">
            <button class="move-btn" onclick="game.selectMove('rock')">ü™®</button>
            <button class="move-btn" onclick="game.selectMove('paper')">üìÑ</button>
            <button class="move-btn" onclick="game.selectMove('scissors')">‚úÇÔ∏è</button>
        </div>
        <button class="btn" onclick="game.prevRound()">Back</button>
    </div>

    <!-- P2 READY -->
    <div id="p2-ready" class="screen">
        <div class="scoreboard">
            <div><div id="p2-ready-name-p1">P1</div><div id="p2-ready-p1-score">0</div></div>
            <div>VS</div>
            <div><div id="p2-ready-name-p2">P2</div><div id="p2-ready-p2-score">0</div></div>
        </div>
        <h2>Hand device to Player 2</h2>
        <button class="btn" onclick="game.toSelection(2)">Pick Moves</button>
    </div>

    <!-- P2 SELECT -->
    <div id="p2-select" class="screen">
        <h2>Round <span id="p2-round-num">1</span>/7</h2>
        <div class="progress-row" id="p2-progress"></div>
        <div class="moves-grid">
            <button class="move-btn" onclick="game.selectMove('rock')">ü™®</button>
            <button class="move-btn" onclick="game.selectMove('paper')">üìÑ</button>
            <button class="move-btn" onclick="game.selectMove('scissors')">‚úÇÔ∏è</button>
        </div>
        <button class="btn" onclick="game.prevRound()">Back</button>
    </div>

    <!-- MATCH READY -->
    <div id="match-ready" class="screen">
        <h2>Ready to Battle!</h2>
        <div class="scoreboard">
            <div><div id="match-p1-name">P1</div><div id="match-p1-score">0</div></div>
            <div>VS</div>
            <div><div id="match-p2-name">P2</div><div id="match-p2-score">0</div></div>
        </div>
        <button class="btn" onclick="game.startBattle()">Start Battle</button>
    </div>

    <!-- BATTLE -->
    <div id="battle" class="screen">
        <div class="scoreboard">
            <div>
                <div id="battle-p1-name">P1</div>
                <div id="battle-p1-score">0</div>
                <div>Set: <span id="set-p1-points">0</span></div>
            </div>
            <div>VS</div>
            <div>
                <div id="battle-p2-name">P2</div>
                <div id="battle-p2-score">0</div>
                <div>Set: <span id="set-p2-points">0</span></div>
            </div>
        </div>
        <div class="countdown-text" id="countdown"></div>
        <div class="fighters">
            <span id="fighter-p1">‚ùî</span>
            <span id="fighter-p2">‚ùî</span>
        </div>
        <div class="result-text" id="result-banner"></div>
        <div class="round-pips" id="round-pips"></div>
    </div>

    <!-- SET RESULT -->
    <div id="set-result" class="screen">
        <h2>Set Complete</h2>
        <div class="scoreboard">
            <div><div>Set Points</div><div id="result-p1-points">0</div></div>
            <div>-</div>
            <div><div>Set Points</div><div id="result-p2-points">0</div></div>
        </div>
        <h2 id="set-winner-text">Winner</h2>
        <button class="btn" onclick="game.continueGame()">Continue</button>
    </div>

    <!-- GAME OVER -->
    <div id="game-over" class="screen">
        <h1>CHAMPION!</h1>
        <h2 id="game-winner-text">Winner</h2>
        <div class="scoreboard">
            <div><div id="final-p1-name">P1</div><div id="final-p1-score">0</div></div>
            <div>-</div>
            <div><div id="final-p2-name">P2</div><div id="final-p2-score">0</div></div>
        </div>
        <button class="btn" onclick="game.playAgain()">Play Again</button>
        <button class="btn" onclick="game.backToMenu()">Main Menu</button>
    </div>

<script>
const game = {
    ROUNDS_PER_SET: 7,
    setsToWin: 2,
    p1SetsWon: 0,
    p2SetsWon: 0,
    p1SetPoints: 0,
    p2SetPoints: 0,
    p1Choices: [],
    p2Choices: [],
    currentRound: 0,
    selectingRound: 0,
    currentPlayer: 1,
    roundResults: [],
    p1Name: 'P1',
    p2Name: 'P2',
    p1Color: '#ff2a6d',
    p2Color: '#05d9e8',
    moves: { rock: 'ü™®', paper: 'üìÑ', scissors: '‚úÇÔ∏è' },
    cycleOrder: ['‚ùî', 'ü™®', '‚ùî', '‚úÇÔ∏è', '‚ùî', 'üìÑ'],
    colors: [
        {c:'#ff2a6d',n:'RED'},{c:'#05d9e8',n:'BLUE'},{c:'#aaff00',n:'GREEN'},
        {c:'#ffaa00',n:'ORANGE'},{c:'#aa00ff',n:'PURPLE'},{c:'#ff69b4',n:'PINK'}
    ],

    init() {
        this.renderColorGrids();
    },

    renderColorGrids() {
        const p1Grid = document.getElementById('p1-colors');
        const p2Grid = document.getElementById('p2-colors');
        p1Grid.innerHTML = '';
        p2Grid.innerHTML = '';
        
        this.colors.forEach(col => {
            const b1 = document.createElement('button');
            b1.className = 'color-btn' + (col.c === this.p1Color ? ' selected' : '');
            b1.style.background = col.c;
            b1.onclick = () => this.selectColor(1, col.c, col.n);
            p1Grid.appendChild(b1);
            
            const b2 = document.createElement('button');
            b2.className = 'color-btn' + (col.c === this.p2Color ? ' selected' : '') + (col.c === this.p1Color ? ' disabled' : '');
            b2.style.background = col.c;
            b2.onclick = () => this.selectColor(2, col.c, col.n);
            p2Grid.appendChild(b2);
        });
    },

    selectColor(player, color, name) {
        if (player === 1 && color === this.p2Color) return;
        if (player === 2 && color === this.p1Color) return;
        
        if (player === 1) {
            this.p1Color = color;
            this.p1Name = name;
        } else {
            this.p2Color = color;
            this.p2Name = name;
        }
        this.renderColorGrids();
    },

    adjustSets(delta) {
        this.setsToWin = Math.max(1, Math.min(5, this.setsToWin + delta));
        document.getElementById('sets-target').textContent = this.setsToWin;
    },

    show(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    startGame() {
        this.p1SetsWon = 0;
        this.p2SetsWon = 0;
        this.resetSet();
        this.updateAllNames();
        this.show('p1-ready');
    },

    resetSet() {
        this.p1Choices = new Array(7).fill(null);
        this.p2Choices = new Array(7).fill(null);
        this.p1SetPoints = 0;
        this.p2SetPoints = 0;
        this.currentRound = 0;
        this.selectingRound = 0;
        this.roundResults = [];
    },

    updateAllNames() {
        document.getElementById('p1-ready-name').textContent = this.p1Name;
        document.getElementById('p2-ready-name').textContent = this.p2Name;
        document.getElementById('p1-ready-score').textContent = this.p1SetsWon;
        document.getElementById('p2-ready-score').textContent = this.p2SetsWon;
        document.getElementById('p1-ready-title').textContent = this.p1Name + ': Select 7 Moves';
        document.getElementById('p2-ready-name-p1').textContent = this.p1Name;
        document.getElementById('p2-ready-name-p2').textContent = this.p2Name;
        document.getElementById('p2-ready-p1-score').textContent = this.p1SetsWon;
        document.getElementById('p2-ready-p2-score').textContent = this.p2SetsWon;
        document.getElementById('match-p1-name').textContent = this.p1Name;
        document.getElementById('match-p2-name').textContent = this.p2Name;
        document.getElementById('battle-p1-name').textContent = this.p1Name;
        document.getElementById('battle-p2-name').textContent = this.p2Name;
        document.getElementById('result-p1-name').textContent = this.p1Name;
        document.getElementById('result-p2-name').textContent = this.p2Name;
        document.getElementById('final-p1-name').textContent = this.p1Name;
        document.getElementById('final-p2-name').textContent = this.p2Name;
    },

    toSelection(player) {
        this.currentPlayer = player;
        this.selectingRound = 0;
        while (this.selectingRound < 7 && this.getCurrentChoices()[this.selectingRound]) {
            this.selectingRound++;
        }
        if (this.selectingRound >= 7) this.selectingRound = 0;
        this.renderProgress();
        this.updateSelectionUI();
        this.show(player === 1 ? 'p1-select' : 'p2-select');
    },

    getCurrentChoices() {
        return this.currentPlayer === 1 ? this.p1Choices : this.p2Choices;
    },

    renderProgress() {
        const container = document.getElementById(this.currentPlayer === 1 ? 'p1-progress' : 'p2-progress');
        container.innerHTML = '';
        const choices = this.getCurrentChoices();
        
        for (let i = 0; i < 7; i++) {
            const dot = document.createElement('div');
            dot.className = 'progress-dot';
            if (i === this.selectingRound) dot.classList.add('current');
            else if (choices[i]) {
                dot.classList.add('filled');
                dot.textContent = this.moves[choices[i]];
            }
            container.appendChild(dot);
        }
    },

    updateSelectionUI() {
        document.getElementById(this.currentPlayer === 1 ? 'p1-round-num' : 'p2-round-num').textContent = this.selectingRound + 1;
        this.renderProgress();
        const choices = this.getCurrentChoices();
        const current = choices[this.selectingRound];
        document.querySelectorAll('.move-btn').forEach(btn => btn.classList.remove('selected'));
        if (current) {
            const map = {rock: 0, paper: 1, scissors: 2};
            const buttons = document.querySelectorAll('.move-btn');
            if (buttons[map[current]]) buttons[map[current]].classList.add('selected');
        }
    },

    selectMove(move) {
        const choices = this.getCurrentChoices();
        choices[this.selectingRound] = move;
        this.updateSelectionUI();
        this.nextRound();
    },

    nextRound() {
        const choices = this.getCurrentChoices();
        if (!choices[this.selectingRound]) return;
        
        if (this.selectingRound < 6) {
            this.selectingRound++;
            this.updateSelectionUI();
        } else {
            if (this.currentPlayer === 1) {
                this.show('p2-ready');
            } else {
                this.showMatchReady();
            }
        }
    },

    prevRound() {
        if (this.selectingRound > 0) {
            this.selectingRound--;
            this.updateSelectionUI();
        }
    },

    showMatchReady() {
        document.getElementById('match-p1-score').textContent = this.p1SetsWon;
        document.getElementById('match-p2-score').textContent = this.p2SetsWon;
        this.show('match-ready');
    },

    async startBattle() {
        this.show('battle');
        this.currentRound = 0;
        this.p1SetPoints = 0;
        this.p2SetPoints = 0;
        this.roundResults = [];
        document.getElementById('battle-p1-score').textContent = this.p1SetsWon;
        document.getElementById('battle-p2-score').textContent = this.p2SetsWon;
        document.getElementById('set-p1-points').textContent = '0';
        document.getElementById('set-p2-points').textContent = '0';
        this.renderRoundPips();
        
        for (let i = 0; i < 7; i++) {
            await this.playRound(i);
        }
        
        let winner = 'tie';
        if (this.p1SetPoints > this.p2SetPoints) winner = 'p1';
        else if (this.p2SetPoints > this.p1SetPoints) winner = 'p2';
        await this.endSet(winner);
    },

    renderRoundPips() {
        const container = document.getElementById('round-pips');
        container.innerHTML = '';
        for (let i = 0; i < 7; i++) {
            const pip = document.createElement('div');
            pip.className = 'pip';
            if (this.roundResults[i]) {
                pip.classList.add(this.roundResults[i] === 'p1' ? 'p1' : (this.roundResults[i] === 'p2' ? 'p2' : 'tie'));
            }
            container.appendChild(pip);
        }
    },

    sleep(ms) { return new Promise(r => setTimeout(r, ms)); },

    async playRound(roundIndex) {
        const f1 = document.getElementById('fighter-p1');
        const f2 = document.getElementById('fighter-p2');
        const countdown = document.getElementById('countdown');
        const banner = document.getElementById('result-banner');
        
        banner.textContent = '';
        f1.textContent = '‚ùî';
        f2.textContent = '‚ùî';
        
        const phases = ['ROCK', 'PAPER', 'SCISSORS', 'SHOOT!'];
        
        for (let i = 0; i < 4; i++) {
            countdown.textContent = phases[i];
            if (i < 3) {
                f1.textContent = this.cycleOrder[(i * 2) % 6];
                f2.textContent = this.cycleOrder[(i * 2) % 6];
                await this.sleep(1000);
            } else {
                f1.textContent = this.moves[this.p1Choices[roundIndex]];
                f2.textContent = this.moves[this.p2Choices[roundIndex]];
                await this.sleep(2000);
                countdown.textContent = '';
            }
        }
        
        const p1Move = this.p1Choices[roundIndex];
        const p2Move = this.p2Choices[roundIndex];
        let winner = null;
        let resultText = '';
        
        if (p1Move === p2Move) {
            winner = 'tie';
            resultText = 'DRAW +0.5';
            this.p1SetPoints += 0.5;
            this.p2SetPoints += 0.5;
        } else if ((p1Move === 'rock' && p2Move === 'scissors') ||
                   (p1Move === 'paper' && p2Move === 'rock') ||
                   (p1Move === 'scissors' && p2Move === 'paper')) {
            winner = 'p1';
            resultText = this.p1Name + ' WINS';
            this.p1SetPoints += 1;
        } else {
            winner = 'p2';
            resultText = this.p2Name + ' WINS';
            this.p2SetPoints += 1;
        }
        
        this.roundResults.push(winner);
        document.getElementById('set-p1-points').textContent = this.p1SetPoints;
        document.getElementById('set-p2-points').textContent = this.p2SetPoints;
        this.renderRoundPips();
        
        banner.textContent = resultText;
        await this.sleep(3000);
        banner.textContent = '';
    },

    async endSet(winner) {
        document.getElementById('result-p1-points').textContent = this.p1SetPoints;
        document.getElementById('result-p2-points').textContent = this.p2SetPoints;
        
        const winnerText = winner === 'p1' ? this.p1Name : this.p2Name;
        document.getElementById('set-winner-text').textContent = winner === 'tie' ? 'SET TIED' : winnerText + ' WINS SET';
        
        if (winner === 'p1') this.p1SetsWon++;
        else if (winner === 'p2') this.p2SetsWon++;
        
        if (this.p1SetsWon >= this.setsToWin || this.p2SetsWon >= this.setsToWin) {
            this.endGame(winner === 'tie' ? (this.p1SetPoints > this.p2SetPoints ? 'p1' : 'p2') : winner);
        } else {
            this.show('set-result');
        }
    },

    endGame(winner) {
        const winnerName = winner === 'p1' ? this.p1Name : this.p2Name;
        document.getElementById('game-winner-text').textContent = winnerName + ' IS CHAMPION';
        document.getElementById('final-p1-score').textContent = this.p1SetsWon;
        document.getElementById('final-p2-score').textContent = this.p2SetsWon;
        this.show('game-over');
    },

    continueGame() {
        this.resetSet();
        this.updateAllNames();
        this.show('p1-ready');
    },

    playAgain() {
        this.p1SetsWon = 0;
        this.p2SetsWon = 0;
        this.resetSet();
        this.show('p1-ready');
    },

    backToMenu() {
        this.show('setup');
    }
};

document.addEventListener('DOMContentLoaded', () => game.init());
</script>
</body>
</html>
