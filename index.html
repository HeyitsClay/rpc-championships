<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPC</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: #000; 
            color: #fff; 
            font-family: system-ui, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .screen { 
            display: none; 
            height: 100%; 
            padding: 20px;
            flex-direction: column;
        }
        .screen.active { display: flex; }
        h1 { text-align: center; margin-bottom: 20px; }
        button {
            background: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 15px;
            font-size: 16px;
            margin: 5px 0;
            width: 100%;
        }
        .row { display: flex; gap: 10px; justify-content: center; margin: 10px 0; }
        .score { display: flex; justify-content: space-between; padding: 15px; border: 1px solid #444; margin: 10px 0; }
        .moves { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px 0; }
        .move { font-size: 48px; padding: 20px; background: #222; border: 1px solid #555; }
        .move.sel { border-color: #fff; background: #444; }
        .dots { display: flex; gap: 5px; justify-content: center; margin: 10px 0; }
        .dot { width: 32px; height: 32px; border: 1px solid #666; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .dot.cur { border-color: #fff; }
        .dot.fil { background: #333; }
        .colors { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .color { width: 36px; height: 36px; border: 2px solid #666; }
        .color.sel { border-color: #fff; }
        .big { font-size: 64px; text-align: center; margin: 20px 0; }
        .center { text-align: center; margin: 10px 0; }
        
        /* Fist bobbing animation */
        @keyframes fist-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .fist-left { animation: fist-bob 0.75s ease-in-out 3; }
        .fist-right { animation: fist-bob 0.75s ease-in-out 3 0.1s; }
    </style>
</head>
<body>

<!-- SETUP -->
<div id="s1" class="screen active" style="overflow-y: auto; justify-content: flex-start;">
    <h1 style="margin: 10px 0; font-size: 20px;">RPC Championships</h1>
    <p class="center" style="margin: 5px 0;">First to <b id="target">3</b> wins</p>
    <div class="row" style="margin: 5px 0;">
        <button onclick="chg(-1)" style="width: 50px;">-</button>
        <button onclick="chg(1)" style="width: 50px;">+</button>
    </div>
    <p class="center" style="margin: 5px 0;">Player 1</p>
    <div class="colors" id="c1" style="margin: 5px 0;"></div>
    <p class="center" style="margin: 5px 0;">Player 2</p>
    <div class="colors" id="c2" style="margin: 5px 0;"></div>
    <button onclick="start()" style="margin-top: 15px;">START GAME</button>
</div>

<!-- P1 PICK -->
<div id="s2" class="screen">
    <div class="score"><span id="n1">P1</span><span>0</span><span>VS</span><span>0</span><span id="n2">P2</span></div>
    <h1 id="t2">Pick 7 Moves</h1>
    <button onclick="goPick(1)">PICK MOVES</button>
</div>

<!-- P1 SELECT -->
<div id="s3" class="screen">
    <p class="center">Round <span id="r3">1</span>/7</p>
    <div class="dots" id="d3"></div>
    <div class="moves">
        <button class="move" onclick="pick('rock')">ü™®</button>
        <button class="move" onclick="pick('paper')">üìÑ</button>
        <button class="move" onclick="pick('scissors')">‚úÇÔ∏è</button>
    </div>
    <button onclick="back()">BACK</button>
</div>

<!-- P2 PICK -->
<div id="s4" class="screen">
    <div class="score"><span>P1</span><span id="s4p1">0</span><span>VS</span><span id="s4p2">0</span><span>P2</span></div>
    <h1>Hand to Player 2</h1>
    <button onclick="goPick(2)">PICK MOVES</button>
</div>

<!-- P2 SELECT -->
<div id="s5" class="screen">
    <p class="center">Round <span id="r5">1</span>/7</p>
    <div class="dots" id="d5"></div>
    <div class="moves">
        <button class="move" onclick="pick('rock')">ü™®</button>
        <button class="move" onclick="pick('paper')">üìÑ</button>
        <button class="move" onclick="pick('scissors')">‚úÇÔ∏è</button>
    </div>
    <button onclick="back()">BACK</button>
</div>

<!-- READY -->
<div id="s6" class="screen">
    <h1>Ready!</h1>
    <div class="score"><span id="n6a">P1</span><span id="s6a">0</span><span>VS</span><span id="s6b">0</span><span id="n6b">P2</span></div>
    <button onclick="battle()">BATTLE</button>
</div>

<!-- BATTLE -->
<div id="s7" class="screen">
    <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333;">
        <span><span id="n7a">P1</span> (<span id="seta">0</span>)</span>
        <span><span id="n7b">P2</span> (<span id="setb">0</span>)</span>
    </div>
    
    <!-- Top row: Phase display with matching emojis -->
    <div id="phase-row" style="display:flex; align-items:center; justify-content:center; gap:30px; margin:20px 0; min-height:80px;">
        <span id="phase-left" style="font-size:48px;">ü™®</span>
        <span id="cnt" style="font-size:24px; font-weight:bold; min-width:120px; text-align:center;">ROCK</span>
        <span id="phase-right" style="font-size:48px;">ü™®</span>
    </div>
    
    <!-- Bottom row: Cycling fighters -->
    <div id="fighters-row" style="display:flex; align-items:center; justify-content:center; gap:40px; margin:20px 0; min-height:90px;">
        <span id="f1" style="font-size:64px;">‚ùî</span>
        <span id="f2" style="font-size:64px;">‚ùî</span>
    </div>
    
    <p class="center" id="res" style="font-size:24px; font-weight:bold; min-height:30px; margin-top:10px;"></p>
    <div class="dots" id="pips" style="margin-top:auto; margin-bottom:20px;"></div>
</div>

<!-- SET END -->
<div id="s8" class="screen">
    <h1>Set Over</h1>
    <div class="score"><span id="n8a">P1</span><span id="s8a">0</span><span>-</span><span id="s8b">0</span><span id="n8b">P2</span></div>
    <h1 id="win8">Winner</h1>
    <button onclick="nextSet()">CONTINUE</button>
</div>

<!-- GAME END -->
<div id="s9" class="screen">
    <h1>CHAMPION</h1>
    <h1 id="win9">Winner</h1>
    <div class="score"><span id="n9a">P1</span><span id="s9a">0</span><span>-</span><span id="s9b">0</span><span id="n9b">P2</span></div>
    <button onclick="again()">PLAY AGAIN</button>
    <button onclick="menu()">MENU</button>
</div>

<script>
// State
let target = 3;
let p1c = '#ff2a6d', p2c = '#05d9e8';
let p1n = 'P1', p2n = 'P2';
let p1s = 0, p2s = 0;
let p1set = 0, p2set = 0;
let p1moves = [], p2moves = [];
let curRound = 0, curPlayer = 1;
let results = [];

const COLS = [
    ['#ff2a6d','RED'],['#05d9e8','BLUE'],['#aaff00','GREEN'],
    ['#ffaa00','ORANGE'],['#aa00ff','PURPLE'],['#ff69b4','PINK']
];
const MOVES = {rock:'ü™®',paper:'üìÑ',scissors:'‚úÇÔ∏è'};
const CYCLE = ['‚ùî','ü™®','‚ùî','‚úÇÔ∏è','‚ùî','üìÑ'];

// Init
function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function init() {
    renderColors();
    show('s1');
}

function renderColors() {
    const c1 = document.getElementById('c1');
    const c2 = document.getElementById('c2');
    c1.innerHTML = '';
    c2.innerHTML = '';
    COLS.forEach(([c,n]) => {
        const b1 = document.createElement('button');
        b1.className = 'color' + (c === p1c ? ' sel' : '');
        b1.style.background = c;
        b1.onclick = () => { p1c = c; p1n = n; renderColors(); };
        c1.appendChild(b1);
        
        const b2 = document.createElement('button');
        b2.className = 'color' + (c === p2c ? ' sel' : '') + (c === p1c ? '' : '');
        b2.style.background = c;
        b2.style.opacity = c === p1c ? '0.3' : '1';
        b2.onclick = () => { if (c !== p1c) { p2c = c; p2n = n; renderColors(); } };
        c2.appendChild(b2);
    });
}

function chg(d) {
    target = Math.max(1, Math.min(5, target + d));
    document.getElementById('target').textContent = target;
}

function start() {
    p1s = 0; p2s = 0;
    newSet();
    show('s2');
}

function newSet() {
    p1moves = new Array(7).fill(null);
    p2moves = new Array(7).fill(null);
    p1set = 0; p2set = 0;
    curRound = 0;
    results = [];
    
    // Update names on screens
    document.getElementById('n1').textContent = p1n;
    document.getElementById('n2').textContent = p2n;
    document.getElementById('t2').textContent = p1n + ': Pick 7 Moves';
}

function goPick(p) {
    curPlayer = p;
    curRound = 0;
    while (curRound < 7 && (p === 1 ? p1moves : p2moves)[curRound]) curRound++;
    if (curRound >= 7) curRound = 0;
    updatePickScreen();
    show(p === 1 ? 's3' : 's5');
}

function updatePickScreen() {
    const isP1 = curPlayer === 1;
    document.getElementById(isP1 ? 'r3' : 'r5').textContent = curRound + 1;
    const dots = document.getElementById(isP1 ? 'd3' : 'd5');
    const moves = isP1 ? p1moves : p2moves;
    dots.innerHTML = '';
    for (let i = 0; i < 7; i++) {
        const d = document.createElement('div');
        d.className = 'dot' + (i === curRound ? ' cur' : '') + (moves[i] ? ' fil' : '');
        d.textContent = moves[i] ? MOVES[moves[i]] : '';
        dots.appendChild(d);
    }
    // Clear selections
    document.querySelectorAll('.move').forEach(m => m.classList.remove('sel'));
    if (moves[curRound]) {
        const map = {rock:0, paper:1, scissors:2};
        const btns = document.querySelectorAll(isP1 ? '#s3 .move' : '#s5 .move');
        if (btns[map[moves[curRound]]]) btns[map[moves[curRound]]].classList.add('sel');
    }
}

function pick(m) {
    if (curPlayer === 1) p1moves[curRound] = m;
    else p2moves[curRound] = m;
    
    if (curRound < 6) {
        curRound++;
        updatePickScreen();
    } else {
        if (curPlayer === 1) {
            document.getElementById('s4p1').textContent = p1s;
            document.getElementById('s4p2').textContent = p2s;
            show('s4');
        } else {
            document.getElementById('n6a').textContent = p1n;
            document.getElementById('n6b').textContent = p2n;
            document.getElementById('s6a').textContent = p1s;
            document.getElementById('s6b').textContent = p2s;
            show('s6');
        }
    }
}

function back() {
    if (curRound > 0) {
        curRound--;
        updatePickScreen();
    }
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

async function battle() {
    show('s7');
    document.getElementById('n7a').textContent = p1n;
    document.getElementById('n7b').textContent = p2n;
    document.getElementById('seta').textContent = '0';
    document.getElementById('setb').textContent = '0';
    
    for (let round = 0; round < 7; round++) {
        document.getElementById('res').textContent = '';
        
        const phases = ['ROCK','PAPER','SCISSORS','SHOOT!'];
        const phaseEmojis = {ROCK:'ü™®', PAPER:'üìÑ', SCISSORS:'‚úÇÔ∏è', 'SHOOT!':'üéØ'};
        
        // Start with fists
        const f1 = document.getElementById('f1');
        const f2 = document.getElementById('f2');
        f1.textContent = 'ü§ú';
        f2.textContent = 'ü§õ';
        
        for (let i = 0; i < 4; i++) {
            const phase = phases[i];
            document.getElementById('cnt').textContent = phase;
            document.getElementById('phase-left').textContent = phaseEmojis[phase];
            document.getElementById('phase-right').textContent = phaseEmojis[phase];
            
            if (i < 3) {
                // ROCK, PAPER, SCISSORS - fists bob up and down
                f1.classList.add('fist-left');
                f2.classList.add('fist-right');
                await sleep(750); // wait for 3 bobs
                f1.classList.remove('fist-left');
                f2.classList.remove('fist-right');
            } else {
                // SHOOT! - reveal actual moves
                f1.textContent = MOVES[p1moves[round]];
                f2.textContent = MOVES[p2moves[round]];
                await sleep(2000); // reveal for 2s
                
                // Clear phase row but keep fighters
                document.getElementById('cnt').textContent = '';
                document.getElementById('phase-left').textContent = '';
                document.getElementById('phase-right').textContent = '';
            }
        }
        
        const m1 = p1moves[round], m2 = p2moves[round];
        let winner, txt;
        
        if (m1 === m2) {
            winner = 'tie'; txt = 'DRAW +0.5';
            p1set += 0.5; p2set += 0.5;
        } else if ((m1==='rock'&&m2==='scissors')||(m1==='paper'&&m2==='rock')||(m1==='scissors'&&m2==='paper')) {
            winner = 'p1'; txt = p1n + ' WINS';
            p1set += 1;
        } else {
            winner = 'p2'; txt = p2n + ' WINS';
            p2set += 1;
        }
        
        results.push(winner);
        document.getElementById('seta').textContent = p1set;
        document.getElementById('setb').textContent = p2set;
        document.getElementById('res').textContent = txt;
        
        // Update pips
        const pips = document.getElementById('pips');
        pips.innerHTML = '';
        for (let i = 0; i < 7; i++) {
            const p = document.createElement('div');
            p.className = 'dot';
            if (results[i] === 'p1') p.style.background = '#fff';
            else if (results[i] === 'p2') p.style.background = '#666';
            else if (results[i] === 'tie') p.style.background = '#333';
            pips.appendChild(p);
        }
        
        await sleep(3000);
        
        // Early exit check
        const remain = 6 - round;
        if (p1set > p2set + remain) break;
        if (p2set > p1set + remain) break;
    }
    
    endSet();
}

function endSet() {
    let win;
    if (p1set > p2set) win = 'p1';
    else if (p2set > p1set) win = 'p2';
    else win = 'tie';
    
    if (win === 'p1') p1s++;
    else if (win === 'p2') p2s++;
    
    document.getElementById('n8a').textContent = p1n;
    document.getElementById('n8b').textContent = p2n;
    document.getElementById('s8a').textContent = p1set;
    document.getElementById('s8b').textContent = p2set;
    document.getElementById('win8').textContent = win === 'tie' ? 'SET TIED' : (win === 'p1' ? p1n : p2n) + ' WINS SET';
    
    if (p1s >= target || p2s >= target) {
        document.getElementById('win9').textContent = (p1s >= target ? p1n : p2n) + ' WINS!';
        document.getElementById('n9a').textContent = p1n;
        document.getElementById('n9b').textContent = p2n;
        document.getElementById('s9a').textContent = p1s;
        document.getElementById('s9b').textContent = p2s;
        show('s9');
    } else {
        show('s8');
    }
}

function nextSet() {
    newSet();
    show('s2');
}

function again() {
    p1s = 0; p2s = 0;
    newSet();
    show('s2');
}

function menu() {
    show('s1');
}

// Start
init();
</script>
</body>
</html>
